name: Create tagged .NET release 

on:
  workflow_call:
    
jobs:
  create-tagged-version:
    permissions:
      id-token: write
      contents: read
      repository-projects: write    
    name: Calculate SemVer
    runs-on: ubuntu-24.04
    steps:  
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  
    - name: Install GitVersion
      uses: gittools/actions/gitversion/setup@v3.1.3
      with:
        versionSpec: '6.0.x'
    - name: Determine SemVer
      id: version_step
      uses: gittools/actions/gitversion/execute@v3.1.3
    - name: Increment SemVer
      id: version_increment
      shell: pwsh
      env: 
        currentsemver: ${{steps.version_step.outputs.majorMinorPatch }}  
      run: |
         $semverString = "$Env:currentsemver"
         $semver =  [version]$semverString
         $major = $semver.Major
         $minor = $semver.Minor
         $build = $semver.Build + 1
         $nextSemver = "$major.$minor.$build"
         Write-Host "Will output next SemVer=$nextSemver" 
         echo "nextSemVer=$nextSemver" >> "$GITHUB_OUTPUT"
    - name: Create tag
      shell: pwsh
      env: 
        semver: ${{steps.version_increment.outputs.nextSemver }}  
      run: |
        $tagName = "v$Env:semver"
        git tag -a $tagName -m "Creating version $Env:semver for deployment"   
        git push origin $tagName

